挖矿


全节点 轻节点
ppt：http://zhenxiao.com/blockchain/08-BTC.pdf


如果在挖矿过程中收到一个区块，且是合法的并且在延伸最长合法链，应该停止现在正在挖的区块，然后重新在本地组装一个候选区块，然后开始挖矿。要沿着新收到的最长合法链挖，本地区块可能会发生变化，因为有些区块可能已经被包含在这个最新的最长合法链中了，而且 block header 中的 previous block hash 和 默克尔树都会发生变化。


放弃已经在挖的区块，去挖新的区块，前面做的工作都白费了。

但是因为 计算 hash 值的 无记忆性，实际上不会有影响，只要没挖出来，期望挖到的时间仍然是 10 分钟


========================

比特币如何保证安全性
1. 密码学上保证，无法伪造签名，没有私钥签名不能花掉 btc（系统中大多数矿工是诚实的）
2. 共识机制

=========================
挖矿设备
1. 通用设备（CPU）：只用到整数运算，内存等都没怎么用到
2. GPU：仍然只用到 整数运算，其他的部件浪费
3. ASIC：专用芯片，为某个（几个）加密货币设计，不通用 mining puzzle


矿池
单个矿工的问题，算力很小，平均需要挖很长时间才能挖到一个区块

poll manager 下连接很多矿机
poll manager 实现全节点的功能，矿机只计算 hash

矿工如何分配收益？
需要有工作量证明。

降低难度，挖到的叫一个 share（almost valid block）
矿工挖到这个区块后，提交给矿主，矿主拿到后没有任何用处，只是用来记录每个矿工的工作量

矿工挖到区块后不提交给矿主，自己发布，能不能行？
不行，因为区块里的收款地址是矿主的，如果改了收款地址呢？
也不行，改了之后 默克尔树 根 hash 值变化


如果挖到了不提交直接丢弃呢？
潜入竞争对手的矿池，搞破坏

矿池让 51% 攻击更容易

===========================
假设有矿池占了 51% 的算力，能发动哪些攻击？

1. 分叉攻击：A -转账-> B，等 6 个区块 B 确认后，发动分叉，再把钱转给自己
2. Boycott（封锁禁用）：禁用某些账户，不打包 A 的交易，只要出现 A 的交易，马上分叉，把 A 的交易剔除，因为自己算力大，这个分叉链很快会成为最长链。其他矿工也不敢把 A 打包进去，因为一大包就会被分叉，自己的工作就白费了
3. 不能把其他账户的钱花了，因为没有私钥签名，如果强行把这个区块大包进去呢？会分叉，诚实节点会沿着另一个分叉继续挖